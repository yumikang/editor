<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—°ë™ í…ŒìŠ¤íŠ¸ ë„êµ¬</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-bottom: 15px;
            color: #34495e;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .data-preview {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .link-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #e3f2fd;
            border-radius: 8px;
        }
        .link-section a {
            color: #2196F3;
            text-decoration: none;
            margin-right: 20px;
        }
        .link-section a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— ì—°ë™ í…ŒìŠ¤íŠ¸ ë„êµ¬</h1>
        
        <div class="test-section">
            <h3>1. localStorage ìƒíƒœ í™•ì¸</h3>
            <button onclick="checkLocalStorage()">localStorage í™•ì¸</button>
            <button onclick="clearLocalStorage()">localStorage ì´ˆê¸°í™”</button>
            <div id="localStorage-status"></div>
        </div>

        <div class="test-section">
            <h3>2. BroadcastChannel í…ŒìŠ¤íŠ¸</h3>
            <button onclick="testBroadcast()">í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡</button>
            <div id="broadcast-status"></div>
        </div>

        <div class="test-section">
            <h3>3. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸</h3>
            <button onclick="testRealtimeUpdate()">í…ŒìŠ¤íŠ¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸</button>
            <div id="realtime-status"></div>
        </div>

        <div class="test-section">
            <h3>4. í˜„ì¬ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°</h3>
            <button onclick="showCurrentData()">ë°ì´í„° í™•ì¸</button>
            <div id="data-preview" class="data-preview" style="display: none;"></div>
        </div>

        <div class="link-section">
            <h3>ğŸ“š ê´€ë ¨ í˜ì´ì§€ ë§í¬</h3>
            <a href="index.html" target="_blank">ğŸ  ë©”ì¸ í™ˆí˜ì´ì§€</a>
            <a href="json-editor-v2.html" target="_blank">âœï¸ JSON ì—ë””í„°</a>
            <a href="instant-update.html" target="_blank">âš¡ ì¦‰ì‹œ ì—…ë°ì´íŠ¸</a>
            <a href="auto-copy.html" target="_blank">ğŸ”„ ìë™ ë³µì‚¬</a>
        </div>
    </div>

    <script>
        // BroadcastChannel ì„¤ì •
        let channel;
        if (typeof BroadcastChannel !== 'undefined') {
            channel = new BroadcastChannel('website-updates');
            channel.addEventListener('message', (e) => {
                showStatus('broadcast-status', 'info', `BroadcastChannel ë©”ì‹œì§€ ìˆ˜ì‹ : ${e.data.type} at ${new Date(e.data.timestamp).toLocaleString('ko-KR')}`);
            });
        }

        function showStatus(elementId, type, message) {
            const statusEl = document.getElementById(elementId);
            statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function checkLocalStorage() {
            const texts = localStorage.getItem('websiteTexts');
            const timestamp = localStorage.getItem('websiteTextsTimestamp');
            
            if (texts) {
                try {
                    const data = JSON.parse(texts);
                    const itemCount = countItems(data);
                    const time = timestamp ? new Date(timestamp).toLocaleString('ko-KR') : 'ì•Œ ìˆ˜ ì—†ìŒ';
                    showStatus('localStorage-status', 'success', 
                        `âœ… localStorageì— ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤!<br>` +
                        `ì´ ${itemCount}ê°œ í•­ëª©<br>` +
                        `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${time}`
                    );
                } catch (error) {
                    showStatus('localStorage-status', 'error', 'âŒ localStorage ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜');
                }
            } else {
                showStatus('localStorage-status', 'error', 'âŒ localStorageì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        function clearLocalStorage() {
            if (confirm('ì •ë§ë¡œ localStorageë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('websiteTexts');
                localStorage.removeItem('websiteTextsTimestamp');
                showStatus('localStorage-status', 'info', 'ğŸ—‘ï¸ localStorageê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        function testBroadcast() {
            if (channel) {
                const testData = {
                    type: 'test-message',
                    timestamp: new Date().toISOString(),
                    message: 'BroadcastChannel í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€'
                };
                channel.postMessage(testData);
                showStatus('broadcast-status', 'success', 'âœ… í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì „ì†¡í–ˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ íƒ­ì„ í™•ì¸í•˜ì„¸ìš”.');
            } else {
                showStatus('broadcast-status', 'error', 'âŒ BroadcastChannelì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }

        function testRealtimeUpdate() {
            const testData = {
                "meta": {
                    "title": { "korean": "í…ŒìŠ¤íŠ¸ ì œëª© - " + new Date().toLocaleTimeString('ko-KR') }
                },
                "hero_section": {
                    "main_title": { "korean": "í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ - " + new Date().toLocaleTimeString('ko-KR') }
                }
            };

            // localStorage ì—…ë°ì´íŠ¸
            localStorage.setItem('websiteTexts', JSON.stringify(testData));
            localStorage.setItem('websiteTextsTimestamp', new Date().toISOString());

            // BroadcastChannelë¡œ ì•Œë¦¼
            if (channel) {
                channel.postMessage({
                    type: 'update-texts',
                    data: testData,
                    timestamp: new Date().toISOString()
                });
            }

            showStatus('realtime-status', 'success', 
                'âœ… í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ë¥¼ ì „ì†¡í–ˆìŠµë‹ˆë‹¤.<br>' +
                'í™ˆí˜ì´ì§€ íƒ­ì—ì„œ ì œëª©ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.'
            );
        }

        function showCurrentData() {
            const texts = localStorage.getItem('websiteTexts');
            const preview = document.getElementById('data-preview');
            
            if (texts) {
                try {
                    const data = JSON.parse(texts);
                    preview.textContent = JSON.stringify(data, null, 2);
                    preview.style.display = 'block';
                } catch (error) {
                    preview.textContent = 'ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜: ' + error.message;
                    preview.style.display = 'block';
                }
            } else {
                preview.textContent = 'localStorageì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
                preview.style.display = 'block';
            }
        }

        function countItems(obj) {
            let count = 0;
            for (const key in obj) {
                if (typeof obj[key] === 'object' && obj[key] !== null) {
                    if (obj[key].korean || obj[key].english) {
                        count++;
                    } else {
                        count += countItems(obj[key]);
                    }
                }
            }
            return count;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì²´í¬
        window.addEventListener('load', () => {
            checkLocalStorage();
        });

        // storage ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('storage', (e) => {
            if (e.key === 'websiteTexts') {
                showStatus('localStorage-status', 'info', 'ğŸ“¡ ë‹¤ë¥¸ íƒ­ì—ì„œ localStorageê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
                checkLocalStorage();
            }
        });
    </script>
</body>
</html>